== Requirements Classes for Functions

[[rc-functions]]
=== Requirements Class "Function Expressions"
==== Overview

This requirements class adds support for defining how to call functions in the expression language.

===== Functions

[#img-uml-class-functions]
.Functions UML Class Diagram
include::../UML/PlantUML/adoc/functions/functions.adoc[]

===== Standard Functions

[#img-uml-class-standard-functions]
.Standard Functions UML Class Diagram
include::../UML/PlantUML/adoc/standardFunctions.adoc[]

* uri: string

[[rc-spatial]]
=== Requirements Class "Spatial Relation Functions"
==== Overview

===== Standard SpatialRelationFunctions

SpatialRelationFunctions are defined in the https://portal.ogc.org/files/?artifact_id=25355[OGC Simple Feature Access - Part 1: Common Architecture] specification and listed in the following table. They involve operations on geometries.

// Do we need to name the functions with the prefix "s_"?
// If it is not the case, don't forget to update the following files:
// - core\UML\PlantUML\adoc\standardFunctions.adoc
// - core\UML\PlantUML\pu\standardFunctions.pu

.SpatialRelationFunctions
[width="90%",options="header"]
|===
| Name	       | Definition	                         | Data type and value | Multiplicity
| s_intersects | s_intersects(Geometry a, Geometry b)| bool                | 1
| s_contains   | s_contains(Geometry a, Geometry b)  | bool                | 1
| s_crosses    | s_crosses(Geometry a, Geometry b)   | bool                | 1
| s_disjoint   | s_disjoint(Geometry a, Geometry b)  | bool                | 1
| s_equals     | s_equals(Geometry a, Geometry b)    | bool                | 1
| s_overlaps   | s_overlaps(Geometry a, Geometry b)  | bool                | 1
| s_touches    | s_touches(Geometry a, Geometry b)   | bool                | 1
| s_within     | s_within(Geometry a, Geometry b)    | bool                | 1
| s_covers     | s_covers(Geometry a, Geometry b)    | bool                | 1
| s_coveredBy  | s_coveredBy(Geometry a, Geometry b) | bool                | 1
|===

===== Geometry

// The bounding box parameter shouldn't be included in the geometry class.

[#img-uml-class-geometry]
.UML Class Diagram of geometry
include::../UML/PlantUML/adoc/geometry.adoc[]

===== Point Geometry

// Reference: https://portal.ogc.org/files/?artifact_id=25355[OGC Simple Feature Access - Part 1: Common Architecture]section 6.1.4 Point

A Point is a 0-dimensional geometric object and represents a single location in coordinate space. A Point has an x-coordinate value, a y-coordinate value. If called for by the associated Spatial Reference System, it may also have coordinate values for z and m.
The boundary of a Point is the empty set.

.Point
[width="90%",options="header"]
|===
| Name	       | Definition	    | Data type and value | Multiplicity
| coordinates  | coordinates	| double              | 2..*
|===

// Reference: https://portal.ogc.org/files/?artifact_id=25355[OGC Simple Feature Access - Part 1: Common Architecture]section 6.1.5 MultiPoint

A MultiPoint is a 0-dimensional GeometryCollection. The elements of a MultiPoint are restricted to Points. The Points are not connected or ordered in any semantically important way (see the discussion at GeometryCollection).
A MultiPoint is simple if no two Points in the MultiPoint are equal (have identical coordinate values in X and Y).
Every MultiPoint is spatially equal to a simple Multipoint.
The boundary of a MultiPoint is the empty set.

.MultiPoint
[width="90%",options="header"]
|===
| Name	       | Definition	    | Data type and value | Multiplicity
| points       | points	        | Point[]             | 2..*
|===

===== Geometry collections

// Reference: https://portal.ogc.org/files/?artifact_id=25355[OGC Simple Feature Access - Part 1: Common Architecture]section 6.1.3 GeometryCollection

A GeometryCollection is a geometric object that is a collection of some number of geometric objects.
All the elements in a GeometryCollection shall be in the same Spatial Reference System. This is also the Spatial Reference System for the GeometryCollection.
GeometryCollection places no other constraints on its elements. Subclasses of GeometryCollection may restrict membership based on dimension and may also place other constraints on the degree of spatial overlap between elements.

.Class GeometryCollection
[width="90%",options="header"]
|===
| Name	         | Definition	                                | Data type and value | Multiplicity
|numGeometries() | number of geometries in the collection	    | int                 | 1
|geometryN()     | returns the n-th geometry in the collection	| Geometry            | 1
|===

===== Line string Geometry 

// Reference: https://portal.ogc.org/files/?artifact_id=25355[OGC Simple Feature Access - Part 1: Common Architecture]section 6.1.7 LineString, Line, LinearRing

A LineString is a Curve with linear interpolation between Points. Each consecutive pair of Points defines a Line segment.

// Should we include a figure with the associated description as figure the figure 6 in the section 6.1.7 of the OGC Simple Feature Access - Part 1: Common Architecture document?

.Class LineString
[width="90%",options="header"]
|===
| Name	     | Definition	                                    | Data type and value | Multiplicity
| points     | the points in this LineString                    | Point               | 2..n
|===

// MultiLineString

// Reference: https://portal.ogc.org/files/?artifact_id=25355[OGC Simple Feature Access - Part 1: Common Architecture]section 6.1.9 MultiLineString

A MultiLineString is a MultiCurve whose elements are LineStrings.

.class MultiLineString
[width="90%",options="header"]
|===
| Name	         | Definition	                                    | Data type and value | Multiplicity
|LineStrings     | line strings in the multilinestring	            | linestring          | 1..n
|===

// Should we include a figure?
// Table to be discussed & added

===== Polygons

// Reference: https://portal.ogc.org/files/?artifact_id=25355[OGC Simple Feature Access - Part 1: Common Architecture] 6.1.11 Polygon, Triangle

A Polygon is a planar Surface defined by 1 exterior boundary and 0 or more interior boundaries. Each interior boundary defines a hole in the Polygon. A Triangle is a polygon with 3 distinct, non-collinear vertices and no interior boundary.

The exterior boundary LinearRing defines the “top” of the surface which is the side of the surface from which the exterior boundary appears to traverse the boundary in a counter clockwise direction. The interior LinearRings will have the opposite orientation, and appear as clockwise when viewed from the “top”,

The assertions for Polygons (the rules that define valid Polygons) are as follows:

a. Polygons are topologically closed;
b. The boundary of a Polygon consists of a set of LinearRings that make up its exterior and interior boundaries;
c. No two Rings in the boundary cross and the Rings in the boundary of a Polygon may intersect at a Point but only as a tangent, e.g.

```
∀ P ∈ Polygon, ∀ c1,c2∈P.Boundary(), c1≠c2,
∀ p, q ∈Point, p, q ∈ c1, p ≠ q ,
[p ∈ c2] ⇒ [∃ δ > 0 ∋ [|p-q|<δ] ⇒ [q ∉ c2] ];
```

__Note:__ This last condition says that at a point common to the two curves, nearby points cannot be common. This forces each common point to be a point of tangency.

[start=4]
d. A Polygon may not have cut lines, spikes or punctures e.g.:

```
∀ P ∈ Polygon, P = P.Interior.Closure;
```
[start=5]
e. The interior of every Polygon is a connected point set;
f. The exterior of a Polygon with 1 or more holes is not connected. Each hole defines a connected component of the exterior.

In the above assertions, interior, closure and exterior have the standard topological definitions. The combination of (a) and (c) makes a Polygon a regular closed Point set. Polygons are simple geometric objects.

// Should we include figure 11 & 12 of the section 6.1.11 of the OGC Simple Feature Access - Part 1: Common Architecture document and the associated description?

.Class Polygon
[width="90%",options="header"]
|===
| Name	         | Definition	                                    | Data type and value | Multiplicity
|exteriorRing    | exterior ring of the polygon	                    | LinearRing          | 1
|interiorRings   | interior rings of the polygon	                | LinearRing          | 0..n
|===

A Polygon is made of an exterior ring and zero or more interior rings.

// to be completed

// MultiPolygons

// Reference: https://portal.ogc.org/files/?artifact_id=25355[OGC Simple Feature Access - Part 1: Common Architecture]section 6.1.14 MultiPolygon

A MultiPolygon is a MultiSurface whose elements are Polygons.
The assertions for MultiPolygons are as follows.

a. The interiors of 2 Polygons that are elements of a MultiPolygon may not intersect.

```
∀M∈MultiPolygon, ∀Pi ,Pj∈M.Geometries(),i≠j,
Interior(P i )∩Interior(Pj ) = ∅;
```
[start=2]
b. The boundaries of any 2 Polygons that are elements of a MultiPolygon may not “cross” and may touch at only
a finite number of Points.

```
∀M∈MultiPolygon, ∀Pi ,Pj∈M.Geometries(),
∀ci, cj∈Curve ci∈Pi .Boundaries(), c j∈Pj .Boundaries()
∃k∈Integer ∋ ci∩cj = {p1 ,...,pk | pm∈Point, 0<m<k};
```

__Note:__ Crossing is prevented by assertion (a) above.

[start=3]
c. A MultiPolygon is defined as topologically closed.
d. A MultiPolygon may not have cut lines, spikes or punctures, a MultiPolygon is a regular closed Point set:

```
∀ M ∈ MultiPolygon, M = Closure(Interior(M))
```
[start=5]
e. The interior of a MultiPolygon with more than 1 Polygon is not connected; the number of connected
components of the interior of a MultiPolygon is equal to the number of Polygons in the MultiPolygon.

The boundary of a MultiPolygon is a set of closed Curves (LineStrings) corresponding to the boundaries of its
element Polygons. Each Curve in the boundary of the MultiPolygon is in the boundary of exactly 1 element
Polygon, and every Curve in the boundary of an element Polygon is in the boundary of the MultiPolygon.

// Should we add the reference to Worboys & Clementini et al. as in the OGC Simple Feature Access - Part 1: Common Architecture document?

// Should we add the figure 17 & 18 of the OGC Simple Feature Access - Part 1: Common Architecture document?

// Table to be discussed & added

.Class MultiPolygon
[width="90%",options="header"]
|===
| Name	         | Definition	                                    | Data type and value | Multiplicity
|polygons        | polygons of the multipolygon	                    | Polygon             | 1..n
|===

[[rc-temporal]]
=== Requirements Class "Temporal Relation Functions"
==== Overview

===== Class Month

* january
* february
* march
* april
* may
* june
* july
* august
* september
* october
* november
* december

===== Class Date

* year: int
* month: Month
* day: int

===== Class TimeOfDay

* hour: int
* minutes: int
* seconds: double

===== Class TimeInstant

* date: Date
* time: TimeOfDay

===== Class TimeInterval

* start: TimeInstant
* end: TimeInstant

===== Standard TemporalRelationFunctions

* t_after(TimeInstant a, TimeInstant b) bool
* t_before(TimeInstant a, TimeInstant b) bool
* t_disjoint(TimeInstant a, TimeInstant b) bool
* t_equals(TimeInstant a, TimeInstant b) bool
* t_intersects(TimeInstant a, TimeInstant b) bool
* t_after(TimeInterval a, TimeInterval b) bool
* t_before(TimeInterval a, TimeInterval b) bool
* t_disjoint(TimeInterval a, TimeInterval b) bool
* t_equals(TimeInterval a, TimeInterval b) bool
* t_intersects(TimeInterval a, TimeInterval b) bool
* t_contains(TimeInterval a, TimeInterval b) bool
* t_during(TimeInterval a, TimeInterval b) bool
* t_finishedBy(TimeInterval a, TimeInterval b) bool
* t_finishes(TimeInterval a, TimeInterval b) bool
* t_meets(TimeInterval a, TimeInterval b) bool
* t_meetBy(TimeInterval a, TimeInterval b) bool
* t_overlappedBy(TimeInterval a, TimeInterval b) bool
* t_overlaps(TimeInterval a, TimeInterval b) bool
* t_startedBy(TimeInterval a, TimeInterval b) bool
* t_starts(TimeInterval a, TimeInterval b) bool

[[rc-arrayrelations]]
=== Requirements Class "Array Relation Functions"
==== Overview

===== Standard ArrayRelationFunctions

* a_containedBy(array a, array b) bool
* a_contains(array a, array b) bool
* a_equals(array a, array b) bool
* a_overlaps(array a, array b) bool

[[rc-textmanipulation]]
=== Requirements Class "Text Manipulation Functions"
==== Overview

===== Class TextManipulationFunctions

* caseInsensitize(string s) : string
* accentInsensitize(string s) : string
* lowerCase(string s) : string
* upperCase(string s) : string
* concatenate(string a, string b) : string
* substitute(string s, string a, string b) : string
* format(string f, ...) : string

[[rc-geometrymanipulation]]
=== Requirements Class "Geometry Manipulation Functions"
==== Overview

===== Standard GeometryManipulationFunctions

* s_intersection(Geometry a, Geometry b) : Geometry
* s_union(Geometry a, Geometry b) : Geometry
* s_subtraction(Geometry a, Geometry b) : Geometry
* s_buffer(Geometry a, double d) : Geometry
